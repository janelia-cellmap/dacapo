

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dacapo.gp.elastic_augment_fuse &mdash; DaCapo  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="dacapo.gp.gamma_noise" href="../gamma_noise/index.html" />
    <link rel="prev" title="dacapo.gp.dacapo_points_source" href="../dacapo_points_source/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            DaCapo
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">DaCapo API:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/minimal_tutorial.html">Minimal Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../unet_architectures.html">UNet Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">Tutorial: A Simple Experiment in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docker.html">Docker Configuration for JupyterHub-Dacapo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../aws.html">AWS EC2 Setup Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cosem_starter.html">Fine-Tune Cosem Starter</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">dacapo</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../apply/index.html">dacapo.apply</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../blockwise/index.html">dacapo.blockwise</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../compute_context/index.html">dacapo.compute_context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../experiments/index.html">dacapo.experiments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ext/index.html">dacapo.ext</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../index.html">dacapo.gp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../options/index.html">dacapo.options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plot/index.html">dacapo.plot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../predict/index.html">dacapo.predict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../predict_local/index.html">dacapo.predict_local</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../store/index.html">dacapo.store</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tmp/index.html">dacapo.tmp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../train/index.html">dacapo.train</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../utils/index.html">dacapo.utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../validate/index.html">dacapo.validate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#package-contents">Package Contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cli.html">CLI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">DaCapo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">dacapo</a></li>
          <li class="breadcrumb-item"><a href="../index.html">dacapo.gp</a></li>
      <li class="breadcrumb-item active">dacapo.gp.elastic_augment_fuse</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/autoapi/dacapo/gp/elastic_augment_fuse/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-dacapo.gp.elastic_augment_fuse">
<span id="dacapo-gp-elastic-augment-fuse"></span><h1>dacapo.gp.elastic_augment_fuse<a class="headerlink" href="#module-dacapo.gp.elastic_augment_fuse" title="Link to this heading"></a></h1>
<section id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Link to this heading"></a></h2>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#dacapo.gp.elastic_augment_fuse.logger" title="dacapo.gp.elastic_augment_fuse.logger"><code class="xref py py-obj docutils literal notranslate"><span class="pre">logger</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Link to this heading"></a></h2>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment" title="dacapo.gp.elastic_augment_fuse.ElasticAugment"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ElasticAugment</span></code></a></p></td>
<td><p>Elasticly deform a batch. Requests larger batches upstream to avoid data</p></td>
</tr>
</tbody>
</table>
</section>
<section id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Link to this heading"></a></h2>
<dl class="py data">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.logger">
<span class="sig-prename descclassname"><span class="pre">dacapo.gp.elastic_augment_fuse.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.logger" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dacapo.gp.elastic_augment_fuse.</span></span><span class="sig-name descname"><span class="pre">ElasticAugment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">control_point_spacing</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">control_point_displacement_sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotation_interval</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentation_probability</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uniform_3d_rotation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment" title="Link to this definition"></a></dt>
<dd><p>Elasticly deform a batch. Requests larger batches upstream to avoid data
loss due to rotation and jitter.
:param control_point_spacing: Distance between control points for the elastic deformation, in voxels per dimension.
:type control_point_spacing: tuple of int
:param control_point_displacement_sigma: Standard deviation of control point displacement distribution, in world coordinates.
:type control_point_displacement_sigma: tuple of float
:param rotation_interval: Interval to randomly sample rotation angles from (0, 2PI).
:type rotation_interval: tuple of two float
:param subsample: Instead of creating an elastic transformation on the full resolution, create one sub-sampled by the given factor, and linearly interpolate to obtain the full resolution transformation. This can significantly speed up this node, at the expense of having visible piecewise linear deformations for large factors. Usually, a factor of 4 can safely be used without noticeable changes. However, the default is 1 (i.e., no sub-sampling).
:type subsample: int
:param seed: Set random state for reproducible results (tests only, do not use in production code!!)
:type seed: int
:param augmentation_probability: Probability to apply the augmentation.
:type augmentation_probability: float
:param uniform_3d_rotation: Use a uniform 3D rotation instead of a rotation around a random axis.
:type uniform_3d_rotation: bool</p>
<dl class="simple">
<dt>Provides:</dt><dd><ul class="simple">
<li><p>The arrays in the batch, deformed.</p></li>
</ul>
</dd>
<dt>Requests:</dt><dd><ul class="simple">
<li><p>The arrays in the batch, enlarged such that the deformed ROI fits into
the enlarged input ROI.</p></li>
</ul>
</dd>
<dt>Method:</dt><dd><p>setup: Set up the ElasticAugment node.
prepare: Prepare the ElasticAugment node.
process: Process the ElasticAugment node.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This node is a port of the ElasticAugment node from the original
<a href="#id1"><span class="problematic" id="id2">`</span></a>gunpowder &lt;</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.control_point_spacing">
<span class="sig-name descname"><span class="pre">control_point_spacing</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.control_point_spacing" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.control_point_displacement_sigma">
<span class="sig-name descname"><span class="pre">control_point_displacement_sigma</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.control_point_displacement_sigma" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.rotation_start">
<span class="sig-name descname"><span class="pre">rotation_start</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.rotation_start" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.rotation_max_amount">
<span class="sig-name descname"><span class="pre">rotation_max_amount</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.rotation_max_amount" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.subsample">
<span class="sig-name descname"><span class="pre">subsample</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.subsample" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.augmentation_probability">
<span class="sig-name descname"><span class="pre">augmentation_probability</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.augmentation_probability" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.uniform_3d_rotation">
<span class="sig-name descname"><span class="pre">uniform_3d_rotation</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.uniform_3d_rotation" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.do_augment">
<span class="sig-name descname"><span class="pre">do_augment</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.do_augment" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.transformations">
<span class="sig-name descname"><span class="pre">transformations</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.transformations" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.target_rois">
<span class="sig-name descname"><span class="pre">target_rois</span></span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.target_rois" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.setup" title="Link to this definition"></a></dt>
<dd><p>Set up the object by calculating the voxel size and spatial dimensions.</p>
<p>This method calculates the voxel size by finding the minimum value for each axis
from the voxel sizes of all array specs. It then sets the <cite>voxel_size</cite> attribute
of the object. The spatial dimensions are also set based on the dimensions of the
voxel size.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>AssertionError</strong> – If the voxel size is not a Coordinate object.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">setup</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.prepare">
<span class="sig-name descname"><span class="pre">prepare</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.prepare" title="Link to this definition"></a></dt>
<dd><p>Prepares the request for augmentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>request</strong> – The request object containing the data to be augmented.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AssertionError</strong> – If the key in the request is not an ArrayKey or GraphKey.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prepare</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<p>This method prepares the request for augmentation by performing the following steps:
1. Logs the preparation details, including the transformation voxel size.
2. Calculates the master ROI based on the total ROI.
3. Generates a uniform random sample and determines whether to perform augmentation based on the augmentation probability.
4. If augmentation is not required, logs the decision and returns.
5. Snaps the master ROI to the grid based on the voxel size and calculates the master transformation.
6. Clears the existing transformations and target ROIs.
7. Iterates over each key in the request and prepares it for augmentation.
8. Updates the upstream request with the modified ROI.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dacapo.gp.elastic_augment_fuse.ElasticAugment.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">request</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dacapo.gp.elastic_augment_fuse.ElasticAugment.process" title="Link to this definition"></a></dt>
<dd><p>Process the ElasticAugment node.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> – The batch object containing the data to be processed.</p></li>
<li><p><strong>request</strong> – The request object specifying the data to be processed.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AssertionError</strong> – If the key in the request is not an ArrayKey or GraphKey.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">process</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<p>This method applies the transformation to the data in the batch and restores the original ROIs.</p>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../dacapo_points_source/index.html" class="btn btn-neutral float-left" title="dacapo.gp.dacapo_points_source" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../gamma_noise/index.html" class="btn btn-neutral float-right" title="dacapo.gp.gamma_noise" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, William Patton, Jeff Rhoades, Marwan Zouinkhi,  David Ackerman, Caroline Malin-Mayor, Jan Funke.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>